"use strict";(self.webpackChunkmoobius_doc=self.webpackChunkmoobius_doc||[]).push([[380],{274:(e,o,n)=>{n.r(o),n.d(o,{assets:()=>l,contentTitle:()=>a,default:()=>u,frontMatter:()=>s,metadata:()=>r,toc:()=>c});var i=n(4848),t=n(8453);const s={id:"Run Demo"},a=void 0,r={id:"tutorial-basics/Run Demo",title:"Run Demo",description:"The Moobius Python SDK is designed for developers to get Moobius up and running quickly and smoothly. It incorporates all the low-level communication APIs and organizes them in a well-structured consistent way. This tutorial will focus on the basic usage of SDK to develop a Moobius CCS, but there are also a bunch of advanced features (database adaptors, wands, schedulers, etc) that facilitates management of complicated GBAs, Cyborgs, and custom User clients with full flexibility.",source:"@site/docs/tutorial-basics/Run Demo.md",sourceDirName:"tutorial-basics",slug:"/tutorial-basics/Run Demo",permalink:"/moobius/tutorial-basics/Run Demo",draft:!1,unlisted:!1,editUrl:"https://github.com/groupultra/moobius/edit/main/docs/tutorial-basics/Run Demo.md",tags:[],version:"current",lastUpdatedBy:"hangyi",lastUpdatedAt:1725863112e3,frontMatter:{id:"Run Demo"},sidebar:"docs",previous:{title:"Preparation",permalink:"/moobius/tutorial-basics/Preparation"},next:{title:"Members and Characters",permalink:"/moobius/tutorial-basics/Members_Characters"}},l={},c=[{value:"install",id:"install",level:3},{value:"config",id:"config",level:2},{value:"starting",id:"starting",level:2}];function d(e){const o={a:"a",admonition:"admonition",code:"code",h2:"h2",h3:"h3",p:"p",pre:"pre",...(0,t.R)(),...e.components};return(0,i.jsxs)(i.Fragment,{children:[(0,i.jsx)(o.p,{children:"The Moobius Python SDK is designed for developers to get Moobius up and running quickly and smoothly. It incorporates all the low-level communication APIs and organizes them in a well-structured consistent way. This tutorial will focus on the basic usage of SDK to develop a Moobius CCS, but there are also a bunch of advanced features (database adaptors, wands, schedulers, etc) that facilitates management of complicated GBAs, Cyborgs, and custom User clients with full flexibility."}),"\n",(0,i.jsx)(o.p,{children:"After the SDK is installed, you can change the current directory of your console (with cd command) to a directory you would like to put your code into (your project directory), and run in your terminal:"}),"\n",(0,i.jsx)(o.h3,{id:"install",children:"install"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-shell",children:"moobius\n"})}),"\n",(0,i.jsx)(o.p,{children:"Alternatively, you can use"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-shell",children:"moobius --gui # Opens a GUI.\n"})}),"\n",(0,i.jsx)(o.p,{children:"Note that GUI mode will not work if you are working on a cloud instance which does not have a GUI or windowing system installed."}),"\n",(0,i.jsx)(o.p,{children:"If you don't specify any parameters, it will prompt you for an email and password. You can enter empty credentials if you don't have an account yet. If so, you will need to save them in the account.json file in order to use the service (see below). (A new Channel will be automatically created if you enter correct credentials)."}),"\n",(0,i.jsx)(o.p,{children:"After this runs, you will have a basic template of a runnable CCS python program along with the necessary configuration files. The structure of your project directory would now look like this:"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-text",children:"|-- project\n    |-- config\n        |-- account.json\n        |-- config.json\n        |-- log.json\n        |-- db.json\n        |-- service.json\n    |-- logs (this folder will appear on the first run)\n        |-- error.log\n        |-- service.log\n    |-- readme.md\n    |-- service.py\n"})}),"\n",(0,i.jsx)(o.h2,{id:"config",children:"config"}),"\n",(0,i.jsxs)(o.p,{children:["You will see a ",(0,i.jsx)(o.code,{children:"config"})," directory in your project directory, and a file named ",(0,i.jsx)(o.code,{children:"account.json"})," inside it, which looks like this:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-json",children:'{\n  "email": "test@example.com",\n  "password": "YourPassword"\n}\n'})}),"\n",(0,i.jsxs)(o.p,{children:["If you did not previously enter your credentials, you will need to change the ",(0,i.jsx)(o.code,{children:"email"})," and ",(0,i.jsx)(o.code,{children:"password"})," field to your own account credentials. Save the file, and open another file named ",(0,i.jsx)(o.code,{children:"service.json"}),":"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-json",children:'{\n  "http_server_uri": "https://api.moobius.link/",\n  "ws_server_uri": "wss://ws.moobius.link/",\n  "service_id": "123123",\n  "channels": ["123123"],\n  "others": "include"\n}\n'})}),"\n",(0,i.jsxs)(o.p,{children:["You will have to fill in your Channel ID if you did not give the credentials originally and did not specifiy a channel; otherwise it will have created a channel for you. Note the ",(0,i.jsx)(o.code,{children:"[]"})," in the ",(0,i.jsx)(o.code,{children:"channels"})," field! It is a JSON list of strings. Which means you can have multiple Channel IDs in that field (seperated by commas). Do not fill in a service ID, it will fill one in for you. Unless your channel has previously been used by another CCS app, then you have to use that service ID."]}),"\n",(0,i.jsx)(o.admonition,{type:"tip",children:(0,i.jsxs)(o.p,{children:["Even you don't have to know it for now, you may be curious about the ",(0,i.jsx)(o.code,{children:"service_id"})," field. Technically, any Custom Channel Service has a unique Service ID on the Moobius Platform as an identifier. One User account can have multiple Service IDs under its name, and each Service ID could be associated with multiple Channels simultaneously. Each Service ID establishes a unique websocket connection to the Moobius platform. When a User Triggers an Upward Event in a Channel, the Moobius Platform will search for the Service ID associated with the Channel, and forward the Event to the Websocket connection. For the purpose of making a new demo, you don't have to fill in the ",(0,i.jsx)(o.code,{children:"service_id"})," field. The SDK will request a new Service ID for you and automatically populate that field. However, the Channel is then associated with that Service ID afterwards (even if you stops the program), so that you may want to write down your Service ID if the Channel is important for you. (todo: detailed explanation of Service association/dissociation and ",(0,i.jsx)(o.code,{children:"others"})," field)"]})}),"\n",(0,i.jsxs)(o.p,{children:['Typically, one program based on our Moobius Python SDK has one "working process" that takes care of one Service ID (i.e. one Websocket connection, but could work on multiple Channels), but the ',(0,i.jsx)(o.code,{children:"MoobiusWand"}),' feature in our SDK allows for a "control process" controlling multiple "working processes" simultaneously, all in one program, which could be useful for large-scale infrastructure of GBA "clusters". The usage of ',(0,i.jsx)(o.code,{children:"MoobiusWand"})," will be covered in our advanced tutorial."]}),"\n",(0,i.jsx)(o.h2,{id:"starting",children:"starting"}),"\n",(0,i.jsxs)(o.p,{children:["Your starting ",(0,i.jsx)(o.code,{children:"service.py"})," looks like this:"]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-python",children:"# service.py\nfrom moobius import Moobius, MoobiusWand, types\n\n\nclass ZeroService(Moobius):\n    pass\n\n\nif __name__ == '__main__':\n    MoobiusWand().run(ZeroService, config='config/config.json', background=True)\n"})}),"\n",(0,i.jsxs)(o.p,{children:["There seems to be nothing in ",(0,i.jsx)(o.code,{children:"ZeroService"}),", but everything fundamental has been nicely packed into the ",(0,i.jsx)(o.code,{children:"Moobius"})," class (network connection, authentication, keep-alive, logging, error handling, API, etc). Additionally, as the core of our SDK, ",(0,i.jsx)(o.code,{children:"Moobius"})," class provides a series of handy functionalities that will be elaborated later. For now, all our ",(0,i.jsx)(o.code,{children:"ZeroService"})," needs to do is to just inherit everything from ",(0,i.jsx)(o.code,{children:"Moobius"})," and when run it will start a valid (but trivial) Service. In later sections, we will guide you step-by-step on how to implement a functional CCS starting from this empty Service template."]}),"\n",(0,i.jsxs)(o.p,{children:["You may notice that a ",(0,i.jsx)(o.code,{children:"MoobiusWand"})," instance is created as the launcher to actually start the Service. This ",(0,i.jsx)(o.code,{children:"Wand"})," feature can manage multiple Services simultaneously running in different processess, and send external injection Events (",(0,i.jsx)(o.code,{children:"spell"}),") to each Service. For now we can safely skip the details and just use it as a simple launcher. For more information about Moobius Wands, please refer to our Advanced Tutorial."]}),"\n",(0,i.jsxs)(o.p,{children:["After you have everything configured properly, you can run your first CCS program on your console (remember to check the working directory of your console is the project directory you specified and has ",(0,i.jsx)(o.code,{children:"service.py"})," in it."]}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-python",children:"python service.py\n"})}),"\n",(0,i.jsx)(o.p,{children:"Wait for a few seconds. If you see logs like this on your console, then it is very likely that your CCS is running!"}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-shell",children:'2024-07-01 15:16:00.437 | INFO     | moobius.network.ws_client:receive:128 - {"type": "copy", "body": {"request_id": "bf47b805-dc7d-4975-a374-466f5891a09a", "origin_type": "heartbeat", "status": true, "context": {}}}\n2024-07-01 15:16:00.437 | DEBUG    | moobius.core.sdk:on_copy_client:922 - on_copy_client\n2024-07-01 15:16:00.473 | INFO     | moobius.network.ws_client:receive:128 - {"type": "copy", "body": {"request_id": "c83b8ee4-409c-497d-9f39-78bc30ad3b6b", "origin_type": "heartbeat", "status": true, "context": {}}}\n2024-07-01 15:16:00.473 | DEBUG    | moobius.core.sdk:on_copy_client:922 - on_copy_client\n'})}),"\n",(0,i.jsx)(o.p,{children:'Go back to your browser for Moobius and refresh your Channel page. You should see the badge next to the Channel title has changed, which indicates a Service has taken over the Channel. You can then send something like "hello world" in the Channel, and you should expect a log appearing in your console like this'}),"\n",(0,i.jsx)(o.pre,{children:(0,i.jsx)(o.code,{className:"language-shell",children:'2024-07-01 17:24:28.479 | INFO     | moobius.network.ws_client:receive:128 - {"type": "message_up", "body": {"subtype": "text", "content": {"text": "hello world"}, "channel_id": "229e6c38-39fb-40b6-9a9a-0f5b0182de85", "timestamp": 1719869068282, "recipients": "24703ea7-a07a-4398-bcd0-396d3db5e60a", "message_id": "35d340ae-351e-47b4-93c8-96124bb08600", "context": {"group_id": "24703ea7-a07a-4398-bcd0-396d3db5e60a", "group_name": "Baozi", "character_num": 1, "channel_type": "ccs"}, "sender": "f6a8ae7f-0382-40f2-b4db-3237326b9a00"}}\n'})}),"\n",(0,i.jsxs)(o.p,{children:["Notice the ",(0,i.jsx)(o.code,{children:'"content": {"text": "hello world"}'})," part. This demonstrates that this Message is already sent to your CCS."]}),"\n",(0,i.jsx)(o.admonition,{type:"tip",children:(0,i.jsxs)(o.p,{children:["The SDK uses ",(0,i.jsx)(o.code,{children:"loguru"})," for logging. Logs are not only printed to console, but saved in the ",(0,i.jsx)(o.code,{children:"log"})," directory under your working directory (which can be automatically created). Using a logging system instead of ",(0,i.jsx)(o.code,{children:"print()"})," is considered a more graceful approach, especially if you want to build something serious instead of a toy. The logging behavior to both the consol and disk can be modified by changing config/log.json You can add your own logs anywhere in your program with calls like ",(0,i.jsx)(o.code,{children:'logger.info("Your log")'}),", after you make ",(0,i.jsx)(o.code,{children:"from loguru import logger"})," statement at the beginning of your code file. For detailed usages of ",(0,i.jsx)(o.code,{children:"loguru"}),", please refer to ",(0,i.jsx)(o.a,{href:"https://github.com/Delgan/loguru",children:"GitHub - Delgan/loguru: Python logging made (stupidly) simple"}),"."]})}),"\n",(0,i.jsx)(o.p,{children:"Congratulations! You are officially a Moobius Developer now, and let's explore the wonderful world of GBA!"}),"\n",(0,i.jsx)(o.admonition,{type:"tip",children:(0,i.jsxs)(o.p,{children:["Our tutorial assumes you have basic knowledge and experience of the Python programming language, including asynchronous programming ",(0,i.jsx)(o.a,{href:"https://docs.python.org/3/library/asyncio-task.html",children:"https://docs.python.org/3/library/asyncio-task.html"})," (",(0,i.jsx)(o.code,{children:"async"}),"/",(0,i.jsx)(o.code,{children:"await"}),"). Don't worry if you are not familiar with the entire field of event loops, coroutines, tasks and futures, since this Basic Tutorial requires almost nothing more than of the basic usage of ",(0,i.jsx)(o.code,{children:"async"})," and ",(0,i.jsx)(o.code,{children:"await"})," keywords. In a word, if a function is defined as asynchronous (using ",(0,i.jsx)(o.code,{children:"async def"})," instead of ",(0,i.jsx)(o.code,{children:"def"}),"), you should call it only inside another ",(0,i.jsx)(o.code,{children:"async"})," function, and use ",(0,i.jsx)(o.code,{children:"await"})," before your call statement (this principle is not strictly true but enough for this tutorial)."]})})]})}function u(e={}){const{wrapper:o}={...(0,t.R)(),...e.components};return o?(0,i.jsx)(o,{...e,children:(0,i.jsx)(d,{...e})}):d(e)}},8453:(e,o,n)=>{n.d(o,{R:()=>a,x:()=>r});var i=n(6540);const t={},s=i.createContext(t);function a(e){const o=i.useContext(s);return i.useMemo((function(){return"function"==typeof e?e(o):{...o,...e}}),[o,e])}function r(e){let o;return o=e.disableParentContext?"function"==typeof e.components?e.components(t):e.components||t:a(e.components),i.createElement(s.Provider,{value:o},e.children)}}}]);